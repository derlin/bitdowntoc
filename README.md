# BitDownToc

This library / program / website generates Markdown table of contents (TOC).
It supports **Gitlab** and **GitHub** styles, and is able to generate anchors to comply with **Bitbucket Server** 
(and its lack of proper markdown support). Thanks to small comments, it can also detect previously generated TOC
and update them, so you can run the tool each time you change your README without worries.

Note that it supports English, French, and most **Latin languages**, but not Cyrillic or Chinese !

TOC (generated by this tool, of course):

<!-- TOC start -->
- [Usage](#usage)
  * [Locally (jar)](#locally-jar)
  * [Online](#online)
- [TOC Flavors and placement](#toc-flavors-and-placement)
- [About the code](#about-the-code)
  * [Motivation](#motivation)
  * [Kotlin all the way !](#kotlin-all-the-way-)
  * [Build and run](#build-and-run)
<!-- TOC end -->

## Usage

### Locally (jar)

The JVM var can be found in the releases. Download it locally, and use:
```bash
# BitBucket Server
java -jar bitdowntoc-jvm-*.jar readme.md --inplace
# GitLab
java -jar bitdowntoc-jvm-*.jar --no-anchors readme.md --inplace
# GitHub
java -jar bitdowntoc-jvm-*.jar --no-anchors --no-concat-spaces readme.md --inplace
```

The tool will output the transformed file depending on the following options (mutually exclusive):

* default: output to stdout;
* `-i`/`--inplace`: replace input file;
* `-o`/`--output`: output to the specified file.

**IMPORTANT**: do not use bash redirects with the same file (input = output), it won't work as you expect !

If you have a doubt, run the tool with `-h` or `--help`.

### Online

Go to https://derlin.github.io/bitdowntoc !


## TOC Flavors and placement

This tool should work properly for GitLab, GitHub and BitBucket Server. Here are the options:

* *BitBucket Server* → generate anchors
* *GitLab* → concat spaces, do not generate anchors
* *GitHub* → do not concat spaces, do not generate anchors

You can control were the toc will be inserted by adding the marker (on its own line):
```text
<!-- TOC start -->
- [Usage](#usage)
  * [Locally (jar)](#locally-jar)
  * [Online](#online)
- [TOC Flavors and placement](#toc-flavors-and-placement)
- [About the code](#about-the-code)
  * [Motivation](#motivation)
  * [Kotlin all the way !](#kotlin-all-the-way-)
  * [Build and run](#build-and-run)
<!-- TOC end -->
```

Note that headers above the marker will be ignored. The option "trim toc" (on by default) means that if 
you have e.g. only level-2 headers below the marker, the TOC will be indented as if those were level 1 headers.

## About the code

### Motivation

I got the motivation from the lack of existing tools supporting **BitBucket Server**.
As of version 6, there are no ID generated for HTML headers in markdown preview, meaning there are no way
of targeting a specific header without manually adding an anchor of the form:
```html
<a name="some-heading"></a>
```

I found [this blog](https://rderik.com/blog/generate-table-of-contents-with-anchors-for-markdown-file-vim-plugin/)
mentioning a Vim plugin doing it for you, but this requires Vim (obviously) and the anchors support leaves in a 
specific branch that is unlikely to be maintained.

I am quite fond of [GitHub Wiki TOC generator](https://ecotrust-canada.github.io/markdown-toc/)
(you should see the inspiration here), and wanted something similar but more flexible 
(not only targeting GitHub and supporting symbols and diacritics).


### Kotlin all the way !

This project was also a great way to play with Kotlin MPP (Multi-Platform Projects).

The code is split between:
* a common module handling the TOC generation, and defining the default options;
* a JVM module with a [Clikt](https://ajalt.github.io/clikt/) cli;
* a JS module that is imported into a static HTML page.

Tests are implemented in the common module, with one exception: some additional tests are located in the JVM module,
because I wanted to load test files and reading files is not supported in common...

### Build and run

To build the project, use the custom target `bitdowntoc`, that will produce the JVM fatJar and copy the compiled
js scripts into the directory `html/scripts`:
```bash
./gradlew bitdowntoc
```
The `html` folder can then be deployed as a static site.


To run tests, use `allTests`:
```bash
./gradlew allTests
```